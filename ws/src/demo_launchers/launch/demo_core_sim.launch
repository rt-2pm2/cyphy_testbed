<?xml version="1.0"?>
<!--
Global Launch File to start the system.
The following nodes will be started:
- VRPN Client Node
- Estimator Nodes for the drones
- Arena Node
- Commander + Guidance Nodes
-->
<launch>
	<arg name="vehicle_frame" default="cf2" />
	<arg name="target" default="target" />
	<arg name="nodeB" default="nodeB" />
	<arg name="ip" default="192.168.1.198" />
	<arg name="port" default="3883" />


		<!-- ===================================== -->
		<!-- Launch the estimator of the object state from
			the VRPN raw data.
		-->
	<include file="$(find demo_launchers)/launch/estimator_launch.launch">
		<arg name="vehicle_frame" value="$(arg vehicle_frame)" />
	</include>



	<!-- ===================================== -->
	<!-- Launch the Arena Node
		<include file="$(find demo_launchers)/launch/arena.launch">
		</include>
	-->

		<!-- ======================================== -->
		<!-- Launch the controller/guidance componets -->
		<include file="$(find demo_launchers)/launch/commander_launch.launch">
			<arg name="vehicle_frame" value="$(arg vehicle_frame)" />
			<arg name="commander_id" value="cm" />
		</include>

		<node pkg="manager" 
			name="swarm_manager" 
			type="manager_node.py"
			respawn="true"
			respawn_delay="3"
			output="screen">
		<rosparam param="droneList">["cf2"] </rosparam>
	</node>

	<!-- Launch the Simulator Node
	-->
	<include file="$(find demo_launchers)/launch/simulator.launch">
	</include>

	<!--
		===================================================
		Control Router 
		This node manages the control switching on the network
	-->
	<node name="control_router"
		pkg="control_router"
		type="control_router_node"
		output="screen">
	<param name="param/vehicle_name" value="$(arg vehicle_frame)" />
</node>

<!-- GEOMETRIC EXTERNAL CONTROLLERS -->
<!-- I would like to remove these namespace in the future and do
	everything with the topic names
-->
<group ns="$(arg vehicle_frame)"> 
	<include file="$(find demo_launchers)/launch/ext_control.launch">
		<arg name="topics/setpoint_topic" value="/$(arg vehicle_frame)/setpoint" />
		<arg name="topics/control_topic" value="/area0/controller/geometric_ctrl/$(arg vehicle_frame)/control" />
		<arg name="topics/ctrl_perf_topic" value="/$(arg vehicle_frame)/ctrl_perf" />
		<arg name="topics/state_topic" value="/$(arg vehicle_frame)/external_codom" />
		<arg name="param/vehicle_name" value="$(arg vehicle_frame)" />
		<arg name="control_mode" value="ANGLES" />
	</include>
</group>

<group ns="$(arg vehicle_frame)"> 
	<node name="cmd_vel_converter" pkg="controller" type="cmd_vel_converter_node" output="screen">
		<param name="topics/control" value="/$(arg vehicle_frame)/control" />
		<param name="topics/cmd_vel" value="/$(arg vehicle_frame)/cmd_vel" />
	</node>
</group>



<!--
	<node pkg="rviz" 
	type="rviz" 
	name="rviz" 
	args="-d $(find state_aggregator)/launch/cyphy_rviz.rviz" > 
	</node>
-->

</launch>
